<script>
    'use strict';
  
    (function () {
      var commentContainer = document.querySelector('#giscus-comments');
  
      if (!commentContainer) {
        return;
      }

      // Get current theme based on body class
      function getGiscusTheme() {
        return document.body.classList.contains('light-theme') ? 'light' : 'dark';
      }

      // Send message to giscus iframe to change theme
      function setGiscusTheme(theme) {
        var iframe = document.querySelector('iframe.giscus-frame');
        if (iframe) {
          iframe.contentWindow.postMessage(
            { giscus: { setConfig: { theme: theme } } },
            'https://giscus.app'
          );
        }
      }

      // Watch for theme changes on body class
      var observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'class') {
            setGiscusTheme(getGiscusTheme());
          }
        });
      });
      observer.observe(document.body, { attributes: true });
      
      var script = document.createElement('script');
      script.setAttribute('src', 'https://giscus.app/client.js');
      script.setAttribute('data-repo', '{{ site.repository | downcase }}');
      script.setAttribute('data-repo-id', '{{ site.comments.giscus.repo_id }}');
      script.setAttribute('data-category', '{{ site.comments.giscus.category_name }}');
      script.setAttribute('data-category-id', '{{ site.comments.giscus.category_id }}');
      script.setAttribute('data-mapping', '{{ site.comments.giscus.discussion_term | default: "pathname" }}');
      script.setAttribute('data-reactions-enabled', '{{ site.comments.giscus.reactions_enabled | default: 1 }}');
      script.setAttribute('data-theme', getGiscusTheme());
      script.setAttribute('crossorigin', 'anonymous');
  
      commentContainer.appendChild(script);
    })();
  </script>